(this["webpackJsonphackernews-reat-apollo"]=this["webpackJsonphackernews-reat-apollo"]||[]).push([[0],{60:function(e,n,t){},77:function(e,n,t){"use strict";t.r(n);var r=t(43),a=t(3),i=t(1),c=t(46),s=t.n(c),o=(t(60),t(14)),l=t(15),u=t(17),d=t(16),p=t(52),j=t(19),b="auth-token";function h(e){return function(e,n){var t=6e4,r=36e5,a=864e5,i=2592e6,c=31536e6,s=e-n;return s<2e4?"just now":s<t?"less than 1 min ago":s<r?Math.round(s/t)+" min ago":s<a?Math.round(s/r)+" h ago":s<i?Math.round(s/a)+" days ago":s<c?Math.round(s/i)+" mo ago":Math.round(s/c)+" years ago"}((new Date).getTime(),new Date(e).getTime())}var f=t(34),m=t(20),v=t.n(m);function O(){var e=Object(j.a)(["\n  mutation VoteMutation($linkId: ID!) {\n    vote(linkId: $linkId) {\n      id\n      link {\n       id\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      user {\n        id\n      }\n    }\n  }\n"]);return O=function(){return e},e}var x=v()(O()),g=function(e){Object(u.a)(t,e);var n=Object(d.a)(t);function t(){return Object(o.a)(this,t),n.apply(this,arguments)}return Object(l.a)(t,[{key:"render",value:function(){var e=this,n=localStorage.getItem(b);return Object(a.jsxs)("div",{className:"flex mt2 items-start",children:[Object(a.jsxs)("div",{className:"flex items-center",children:[Object(a.jsxs)("span",{className:"gray",children:[this.props.index+1,"."]}),n&&Object(a.jsx)(f.a,{mutation:x,variables:{linkId:this.props.link.id},update:function(n,t){var r=t.data.vote;return e.props.updateStoreAfterVote(n,r,e.props.link.id)},children:function(e){return Object(a.jsx)("div",{className:"ml1 gray f11",onClick:e,children:"\u25b2"})}})]}),Object(a.jsxs)("div",{className:"ml1",children:[Object(a.jsxs)("div",{children:[this.props.link.description," (",this.props.link.url,")"]}),Object(a.jsxs)("div",{className:"f6 lh-copy gray",children:[this.props.link.votes.length," votes | by"," ",this.props.link.postedBy?this.props.link.postedBy.name:"Unknown"," ",h(this.props.link.createdAt)]})]})]})}}]),t}(i.Component);function k(){var e=Object(j.a)(["\n  subscription {\n    newVote {\n      id\n      link {\n        id\n        url\n        description\n        createdAt\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      user {\n        id\n      }\n    }\n  }\n"]);return k=function(){return e},e}function y(){var e=Object(j.a)(["\n  subscription {\n    newLink {\n      id\n      url\n      description\n      createdAt\n      postedBy {\n        id\n        name\n      }\n      votes {\n        id\n        user {\n          id\n        }\n      }\n    }\n  }\n"]);return y=function(){return e},e}function w(){var e=Object(j.a)(["\n  query FeedQuery($first: Int, $skip: Int, $orderBy: LinkOrderByInput) {\n    feed(first: $first, skip: $skip, orderBy: $orderBy) {\n      links {\n        id\n        createdAt\n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      count\n    }\n  }\n"]);return w=function(){return e},e}var N=v()(w()),S=v()(y()),C=v()(k()),_=function(e){Object(u.a)(t,e);var n=Object(d.a)(t);function t(){var e;Object(o.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=n.call.apply(n,[this].concat(a)))._updateCacheAfterVote=function(n,t,r){var a=e.props.location.pathname.includes("new"),i=parseInt(e.props.match.params.page,10),c=a?5*(i-1):0,s=a?5:100,o=a?"createdAt_DESC":null,l=n.readQuery({query:N,variables:{first:s,skip:c,orderBy:o}});l.feed.links.find((function(e){return e.id===r})).votes=t.link.votes,n.writeQuery({query:N,data:l})},e._subscribeToNewLinks=function(e){e({document:S,updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;var r=t.data.newLink;return e.feed.links.find((function(e){return e.id===r.id}))?e:Object.assign({},e,{feed:{links:[r].concat(Object(p.a)(e.feed.links)),count:e.feed.links.length+1,__typename:e.feed.__typename}})}})},e._subscribeToNewVotes=function(e){e({document:C})},e._getQueryVariables=function(){var n=e.props.location.pathname.includes("new"),t=parseInt(e.props.match.params.page,10);return{first:n?5:100,skip:n?5*(t-1):0,orderBy:n?"createdAt_DESC":null}},e._getLinksToRender=function(n){if(e.props.location.pathname.includes("new"))return n.feed.links;var t=n.feed.links.slice();return t.sort((function(e,n){return n.votes.length-e.votes.length})),t},e._nextPage=function(n){var t=parseInt(e.props.match.params.page,10);if(t<=n.feed.count/5){var r=t+1;e.props.history.push("/new/".concat(r))}},e._previousPage=function(){var n=parseInt(e.props.match.params.page,10);if(n>1){var t=n-1;e.props.history.push("/new/".concat(t))}},e}return Object(l.a)(t,[{key:"render",value:function(){var e=this;return Object(a.jsx)(f.b,{query:N,variables:this._getQueryVariables(),children:function(n){var t=n.loading,r=n.error,c=n.data,s=n.subscribeToMore;if(t)return Object(a.jsx)("div",{children:"Fetching"});if(r)return Object(a.jsx)("div",{children:"Error"});e._subscribeToNewLinks(s),e._subscribeToNewVotes(s);var o=e._getLinksToRender(c),l=e.props.location.pathname.includes("new"),u=e.props.match.params.page?5*(e.props.match.params.page-1):0;return Object(a.jsxs)(i.Fragment,{children:[o.map((function(n,t){return Object(a.jsx)(g,{link:n,index:t+u,updateStoreAfterVote:e._updateCacheAfterVote},n.id)})),l&&Object(a.jsxs)("div",{className:"flex ml4 mv3 gray",children:[Object(a.jsx)("div",{className:"pointer mr2",onClick:e._previousPage,children:"Previous"}),Object(a.jsx)("div",{className:"pointer",onClick:function(){return e._nextPage(c)},children:"Next"})]})]})}})}}]),t}(i.Component);function $(){var e=Object(j.a)(["\n  mutation PostMutation($description: String!, $url: String!) {\n    post(description: $description, url: $url) {\n      id\n      createdAt\n      url\n      description\n    }\n  }\n"]);return $=function(){return e},e}var I=v()($()),A=function(e){Object(u.a)(t,e);var n=Object(d.a)(t);function t(){var e;Object(o.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=n.call.apply(n,[this].concat(a))).state={description:"",url:""},e}return Object(l.a)(t,[{key:"render",value:function(){var e=this,n=this.state,t=n.description,r=n.url;return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{className:"flex flex-column mt3",children:[Object(a.jsx)("input",{className:"mb2",value:t,onChange:function(n){return e.setState({description:n.target.value})},type:"text",placeholder:"A description for the link"}),Object(a.jsx)("input",{className:"mb2",value:r,onChange:function(n){return e.setState({url:n.target.value})},type:"text",placeholder:"The URL for the link"})]}),Object(a.jsx)(f.a,{mutation:I,variables:{description:t,url:r},onCompleted:function(){return e.props.history.push("/new/1")},update:function(e,n){var t=n.data.post,r="createdAt_DESC",a=e.readQuery({query:N,variables:{first:5,skip:0,orderBy:r}});a.feed.links.unshift(t),e.writeQuery({query:N,data:a,variables:{first:5,skip:0,orderBy:r}})},children:function(e){return Object(a.jsx)("button",{onClick:e,children:"Submit"})}})]})}}]),t}(i.Component),B=t(24),T=t(9),q=function(e){Object(u.a)(t,e);var n=Object(d.a)(t);function t(){return Object(o.a)(this,t),n.apply(this,arguments)}return Object(l.a)(t,[{key:"render",value:function(){var e=this,n=localStorage.getItem(b);return Object(a.jsxs)("div",{className:"flex pa1 justify-between nowrap orange",children:[Object(a.jsxs)("div",{className:"flex flex-fixed black",children:[Object(a.jsx)("div",{className:"fw7 mr1",children:"Hacker News"}),Object(a.jsx)(B.b,{to:"/",className:"ml1 no-underline black",children:"new"}),Object(a.jsx)("div",{className:"ml1",children:"|"}),Object(a.jsx)(B.b,{to:"/top",className:"ml1 no-underline black",children:"top"}),Object(a.jsx)("div",{className:"ml1",children:"|"}),Object(a.jsx)(B.b,{to:"/search",className:"ml1 no-underline black",children:"search"}),n&&Object(a.jsxs)("div",{className:"flex",children:[Object(a.jsx)("div",{className:"ml1",children:"|"}),Object(a.jsx)(B.b,{to:"/create",className:"ml1 no-underline black",children:"submit"})]})]}),Object(a.jsx)("div",{className:"flex flex-fixed",children:n?Object(a.jsx)("div",{className:"ml1 pointer black",onClick:function(){localStorage.removeItem(b),e.props.history.push("/")},children:"logout"}):Object(a.jsx)(B.b,{to:"/login",className:"ml1 no-underline black",children:"login"})})]})}}]),t}(i.Component),D=Object(T.g)(q),L=t(28),M=t.n(L),V=t(33);function Q(){var e=Object(j.a)(["\n  mutation LoginMutation($email: String!, $password: String!) {\n    login(email: $email, password: $password) {\n      token\n    }\n  }\n"]);return Q=function(){return e},e}function P(){var e=Object(j.a)(["\n  mutation SignupMutation($email: String!, $password: String!, $name: String!) {\n    signup(email: $email, password: $password, name: $name) {\n      token\n    }\n  }\n"]);return P=function(){return e},e}var E=v()(P()),U=v()(Q()),F=function(e){Object(u.a)(t,e);var n=Object(d.a)(t);function t(){var e;Object(o.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=n.call.apply(n,[this].concat(a))).state={login:!0,email:"",password:"",name:""},e._confirm=function(){var n=Object(V.a)(M.a.mark((function n(t){var r,a;return M.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=e.state.login?t.login:t.signup,a=r.token,e._saveUserData(a),e.props.history.push("/");case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e._saveUserData=function(e){localStorage.setItem(b,e)},e}return Object(l.a)(t,[{key:"render",value:function(){var e=this,n=this.state,t=n.login,r=n.email,i=n.password,c=n.name;return Object(a.jsxs)("div",{children:[Object(a.jsx)("h4",{className:"mv3",children:t?"Login":"Sign Up"}),Object(a.jsxs)("div",{className:"flex flex-column",children:[!t&&Object(a.jsx)("input",{value:c,onChange:function(n){return e.setState({name:n.target.value})},type:"text",placeholder:"Your name"}),Object(a.jsx)("input",{value:r,onChange:function(n){return e.setState({email:n.target.value})},type:"text",placeholder:"Your email address"}),Object(a.jsx)("input",{value:i,onChange:function(n){return e.setState({password:n.target.value})},type:"password",placeholder:"Choose a safe password"})]}),Object(a.jsxs)("div",{className:"flex mt3",children:[Object(a.jsx)(f.a,{mutation:t?U:E,variables:{email:r,password:i,name:c},onCompleted:function(n){return e._confirm(n)},children:function(e){return Object(a.jsx)("div",{className:"pointer mr2 button",onClick:e,children:t?"login":"create account"})}}),Object(a.jsx)("div",{className:"pointer button",onClick:function(){return e.setState({login:!t})},children:t?"need to create an account?":"already have an account?"})]})]})}}]),t}(i.Component),R=t(78);function J(){var e=Object(j.a)(["\n  query FeedSearchQuery($filter: String!) {\n    feed(filter: $filter) {\n      links {\n        id\n        url\n        description\n        createdAt\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n    }\n  }\n"]);return J=function(){return e},e}var Y=v()(J()),z=function(e){Object(u.a)(t,e);var n=Object(d.a)(t);function t(){var e;Object(o.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=n.call.apply(n,[this].concat(a))).state={links:[],filter:""},e._executeSearch=Object(V.a)(M.a.mark((function n(){var t,r,a;return M.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.state.filter,n.next=3,e.props.client.query({query:Y,variables:{filter:t}});case 3:r=n.sent,a=r.data.feed.links,e.setState({links:a});case 6:case"end":return n.stop()}}),n)}))),e}return Object(l.a)(t,[{key:"render",value:function(){var e=this;return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{children:["Search",Object(a.jsx)("input",{type:"text",onChange:function(n){return e.setState({filter:n.target.value})}}),Object(a.jsx)("button",{onClick:function(){return e._executeSearch()},children:"OK"})]}),this.state.links.map((function(e,n){return Object(a.jsx)(g,{link:e,index:n},e.id)}))]})}}]),t}(i.Component),H=Object(R.a)(z),K=function(e){Object(u.a)(t,e);var n=Object(d.a)(t);function t(){return Object(o.a)(this,t),n.apply(this,arguments)}return Object(l.a)(t,[{key:"render",value:function(){return Object(a.jsxs)("div",{className:"center w85",children:[Object(a.jsx)(D,{}),Object(a.jsx)("div",{className:"ph3 pv1 background-gray",children:Object(a.jsxs)(T.d,{children:[Object(a.jsx)(T.b,{exact:!0,path:"/",render:function(){return Object(a.jsx)(T.a,{to:"/new/1"})}}),Object(a.jsx)(T.b,{exact:!0,path:"/create",component:A}),Object(a.jsx)(T.b,{exact:!0,path:"/login",component:F}),Object(a.jsx)(T.b,{exact:!0,path:"/search",component:H}),Object(a.jsx)(T.b,{exact:!0,path:"/top",component:_}),Object(a.jsx)(T.b,{exact:!0,path:"/new/:page",component:_})]})})]})}}]),t}(i.Component),G=t(50),W=t(13),X=t(51),Z=t(2),ee=t(7),ne=t(25),te=t(54),re=t(53),ae=Object(te.a)({uri:"http://localhost:4000"}),ie=Object(G.a)((function(e,n){var t=n.headers,a=localStorage.getItem(b);return{headers:Object(r.a)(Object(r.a)({},t),{},{authorization:a?"Bearer ".concat(a):""})}})),ce=new X.a({uri:"ws://localhost:4000",options:{reconnect:!0,connectionParams:{authToken:localStorage.getItem(b)}}}),se=Object(W.d)((function(e){var n=e.query,t=Object(Z.l)(n),r=t.kind,a=t.operation;return"OperationDefinition"===r&&"subscription"===a}),ce,ie.concat(ae)),oe=new ne.a({link:se,cache:new re.a});s.a.render(Object(a.jsx)(B.a,{children:Object(a.jsx)(ee.b,{client:oe,children:Object(a.jsx)(K,{})})}),document.getElementById("root"))}},[[77,1,2]]]);
//# sourceMappingURL=main.dde943bf.chunk.js.map